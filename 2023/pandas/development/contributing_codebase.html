
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Contributing to the code base &#8212; pandas 1.4.3 documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pandas code style guide" href="code_style.html" />
    <link rel="prev" title="pandas docstring guide" href="contributing_docstring.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-27880019-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/pandas.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../whatsnew/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        1.4.3  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables development/contributing_codebase and {'json_url': 'https://pandas.pydata.org/versions.json', 'url_template': 'https://pandas.pydata.org/{version}/', 'version_match': '1.4.3'}.
-->

<script type="text/javascript">
// Construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://pandas.pydata.org/{version}/";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "development/contributing_codebase.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://pandas.pydata.org/versions.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "development/contributing_codebase.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            // get the base URL for that doc version, add the current page's
            // path to it, and set as `href`
            entry.url = buildURL(entry);
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.4.3 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "1.4.3") {
                node.classList.add("active");
                $("#version_switcher_button").text(entry.name);
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/pandas-dev/pandas" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/pandas_dev" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing to pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributing_environment.html">
   Creating a development environment
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="contributing_documentation.html">
   Contributing to the documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="contributing_docstring.html">
     pandas docstring guide
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Contributing to the code base
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code_style.html">
   pandas code style guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="maintaining.html">
   pandas maintenance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="internals.html">
   Internals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="test_writing.html">
   Test organization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="debugging_extensions.html">
   Debugging C extensions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="extending.html">
   Extending pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="developer.html">
   Developer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="policies.html">
   Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="meeting.html">
   Developer meetings
  </a>
 </li>
</ul>

    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-standards">
   Code standards
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-commit">
   Pre-commit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-dependencies">
   Optional dependencies
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-cpplint">
     C (cpplint)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-pep8-black">
     Python (PEP8 / black)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-formatting">
     Import formatting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#backwards-compatibility">
     Backwards compatibility
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-hints">
   Type hints
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#style-guidelines">
     Style guidelines
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pandas-specific-types">
     pandas-specific types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validating-type-hints">
     Validating type hints
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-type-hints-in-code-using-pandas">
     Testing type hints in code using pandas
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-with-continuous-integration">
   Testing with continuous integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-driven-development-code-writing">
   Test-driven development/code writing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-tests">
     Writing tests
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transitioning-to-pytest">
     Transitioning to
     <code class="docutils literal notranslate">
      <span class="pre">
       pytest
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-pytest">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       pytest
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-hypothesis">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       hypothesis
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-warnings">
     Testing warnings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-test-suite">
   Running the test suite
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-performance-test-suite">
   Running the performance test suite
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#documenting-your-code">
   Documenting your code
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="contributing-to-the-code-base">
<span id="contributing-codebase"></span><h1>Contributing to the code base<a class="headerlink" href="#contributing-to-the-code-base" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#code-standards" id="id3">Code standards</a></p></li>
<li><p><a class="reference internal" href="#pre-commit" id="id4">Pre-commit</a></p></li>
<li><p><a class="reference internal" href="#optional-dependencies" id="id5">Optional dependencies</a></p>
<ul>
<li><p><a class="reference internal" href="#c-cpplint" id="id6">C (cpplint)</a></p></li>
<li><p><a class="reference internal" href="#python-pep8-black" id="id7">Python (PEP8 / black)</a></p></li>
<li><p><a class="reference internal" href="#import-formatting" id="id8">Import formatting</a></p></li>
<li><p><a class="reference internal" href="#backwards-compatibility" id="id9">Backwards compatibility</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#type-hints" id="id10">Type hints</a></p>
<ul>
<li><p><a class="reference internal" href="#style-guidelines" id="id11">Style guidelines</a></p></li>
<li><p><a class="reference internal" href="#pandas-specific-types" id="id12">pandas-specific types</a></p></li>
<li><p><a class="reference internal" href="#validating-type-hints" id="id13">Validating type hints</a></p></li>
<li><p><a class="reference internal" href="#testing-type-hints-in-code-using-pandas" id="id14">Testing type hints in code using pandas</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-with-continuous-integration" id="id15">Testing with continuous integration</a></p></li>
<li><p><a class="reference internal" href="#test-driven-development-code-writing" id="id16">Test-driven development/code writing</a></p>
<ul>
<li><p><a class="reference internal" href="#writing-tests" id="id17">Writing tests</a></p></li>
<li><p><a class="reference internal" href="#transitioning-to-pytest" id="id18">Transitioning to <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></p></li>
<li><p><a class="reference internal" href="#using-pytest" id="id19">Using <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></p></li>
<li><p><a class="reference internal" href="#using-hypothesis" id="id20">Using <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code></a></p></li>
<li><p><a class="reference internal" href="#testing-warnings" id="id21">Testing warnings</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-test-suite" id="id22">Running the test suite</a></p></li>
<li><p><a class="reference internal" href="#running-the-performance-test-suite" id="id23">Running the performance test suite</a></p></li>
<li><p><a class="reference internal" href="#documenting-your-code" id="id24">Documenting your code</a></p></li>
</ul>
</div>
<section id="code-standards">
<h2><a class="toc-backref" href="#id3">Code standards</a><a class="headerlink" href="#code-standards" title="Permalink to this headline">¶</a></h2>
<p>Writing good code is not just about what you write. It is also about <em>how</em> you
write it. During <a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> testing, several
tools will be run to check your code for stylistic errors.
Generating any warnings will cause the test to fail.
Thus, good style is a requirement for submitting code to pandas.</p>
<p>There is a tool in pandas to help contributors verify their changes before
contributing them to the project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ci</span><span class="o">/</span><span class="n">code_checks</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The script validates the doctests, formatting in docstrings, static typing, and
imported modules. It is possible to run the checks independently by using the
parameters <code class="docutils literal notranslate"><span class="pre">docstring</span></code>, <code class="docutils literal notranslate"><span class="pre">code</span></code>, <code class="docutils literal notranslate"><span class="pre">typing</span></code>, and <code class="docutils literal notranslate"><span class="pre">doctests</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">./ci/code_checks.sh</span> <span class="pre">doctests</span></code>).</p>
<p>In addition, because a lot of people use our library, it is important that we
do not make sudden changes to the code that could have the potential to break
a lot of user code as a result, that is, we need it to be as <em>backwards compatible</em>
as possible to avoid mass breakages.</p>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">./ci/code_checks.sh</span></code>, some extra checks are run by
<code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> - see <a class="reference internal" href="#contributing-pre-commit"><span class="std std-ref">here</span></a> for how to
run them.</p>
<p>Additional standards are outlined on the <a class="reference internal" href="code_style.html#code-style"><span class="std std-ref">pandas code style guide</span></a>.</p>
</section>
<section id="pre-commit">
<span id="contributing-pre-commit"></span><h2><a class="toc-backref" href="#id4">Pre-commit</a><a class="headerlink" href="#pre-commit" title="Permalink to this headline">¶</a></h2>
<p>You can run many of these styling checks manually as we have described above. However,
we encourage you to use <a class="reference external" href="https://pre-commit.com/">pre-commit hooks</a> instead
to automatically run <code class="docutils literal notranslate"><span class="pre">black</span></code>, <code class="docutils literal notranslate"><span class="pre">flake8</span></code>, <code class="docutils literal notranslate"><span class="pre">isort</span></code> when you make a git commit. This
can be done by installing <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pre</span><span class="o">-</span><span class="n">commit</span>
</pre></div>
</div>
<p>and then running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">install</span>
</pre></div>
</div>
<p>from the root of the pandas repository. Now all of the styling checks will be
run each time you commit changes without your needing to run each one manually.
In addition, using <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> will also allow you to more easily
remain up-to-date with our code checks as they change.</p>
<p>Note that if needed, you can skip these checks with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">--no-verify</span></code>.</p>
<p>If you don’t want to use <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> as part of your workflow, you can still use it
to run its checks with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">run</span> <span class="o">--</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">files</span> <span class="n">you</span> <span class="n">have</span> <span class="n">modified</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>without needing to have done <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> beforehand.</p>
<p>If you want to run checks on all recently committed files on upstream/main you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">run</span> <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="n">HEAD</span> <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
<p>without needing to have done <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> beforehand.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have conflicting installations of <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>, then you may get an
error - see <a class="reference external" href="https://github.com/pypa/virtualenv/issues/1875">here</a>.</p>
<p>Also, due to a <a class="reference external" href="https://github.com/pypa/virtualenv/issues/1986">bug in virtualenv</a>,
you may run into issues if you’re using conda. To solve this, you can downgrade
<code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> to version <code class="docutils literal notranslate"><span class="pre">20.0.33</span></code>.</p>
</div>
</section>
<section id="optional-dependencies">
<h2><a class="toc-backref" href="#id5">Optional dependencies</a><a class="headerlink" href="#optional-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Optional dependencies (e.g. matplotlib) should be imported with the private helper
<code class="docutils literal notranslate"><span class="pre">pandas.compat._optional.import_optional_dependency</span></code>. This ensures a
consistent error message when the dependency is not met.</p>
<p>All methods using an optional dependency should include a test asserting that an
<code class="docutils literal notranslate"><span class="pre">ImportError</span></code> is raised when the optional dependency is not found. This test
should be skipped if the library is present.</p>
<p>All optional dependencies should be documented in
<a class="reference internal" href="../getting_started/install.html#install-optional-dependencies"><span class="std std-ref">Optional dependencies</span></a> and the minimum required version should be
set in the <code class="docutils literal notranslate"><span class="pre">pandas.compat._optional.VERSIONS</span></code> dict.</p>
<section id="c-cpplint">
<h3><a class="toc-backref" href="#id6">C (cpplint)</a><a class="headerlink" href="#c-cpplint" title="Permalink to this headline">¶</a></h3>
<p>pandas uses the <a class="reference external" href="https://google.github.io/styleguide/cppguide.html">Google</a>
standard. Google provides an open source style checker called <code class="docutils literal notranslate"><span class="pre">cpplint</span></code>, but we
use a fork of it that can be found <a class="reference external" href="https://github.com/cpplint/cpplint">here</a>.
Here are <em>some</em> of the more common <code class="docutils literal notranslate"><span class="pre">cpplint</span></code> issues:</p>
<ul class="simple">
<li><p>we restrict line-length to 80 characters to promote readability</p></li>
<li><p>every header file must include a header guard to avoid name collisions if re-included</p></li>
</ul>
<p><a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> will run the
<a class="reference external" href="https://pypi.org/project/cpplint">cpplint</a> tool
and report any stylistic errors in your code. Therefore, it is helpful before
submitting code to run the check yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cpplint</span> <span class="o">--</span><span class="n">extensions</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">h</span> <span class="o">--</span><span class="n">headers</span><span class="o">=</span><span class="n">h</span> <span class="o">--</span><span class="nb">filter</span><span class="o">=-</span><span class="n">readability</span><span class="o">/</span><span class="n">casting</span><span class="p">,</span><span class="o">-</span><span class="n">runtime</span><span class="o">/</span><span class="nb">int</span><span class="p">,</span><span class="o">-</span><span class="n">build</span><span class="o">/</span><span class="n">include_subdir</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
<p>You can also run this command on an entire directory if necessary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cpplint</span> <span class="o">--</span><span class="n">extensions</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">h</span> <span class="o">--</span><span class="n">headers</span><span class="o">=</span><span class="n">h</span> <span class="o">--</span><span class="nb">filter</span><span class="o">=-</span><span class="n">readability</span><span class="o">/</span><span class="n">casting</span><span class="p">,</span><span class="o">-</span><span class="n">runtime</span><span class="o">/</span><span class="nb">int</span><span class="p">,</span><span class="o">-</span><span class="n">build</span><span class="o">/</span><span class="n">include_subdir</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">directory</span>
</pre></div>
</div>
<p>To make your commits compliant with this standard, you can install the
<a class="reference external" href="https://clang.llvm.org/docs/ClangFormat.html">ClangFormat</a> tool, which can be
downloaded <a class="reference external" href="https://llvm.org/builds/">here</a>. To configure, in your home directory,
run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clang</span><span class="o">-</span><span class="nb">format</span> <span class="n">style</span><span class="o">=</span><span class="n">google</span> <span class="o">-</span><span class="n">dump</span><span class="o">-</span><span class="n">config</span>  <span class="o">&gt;</span> <span class="o">.</span><span class="n">clang</span><span class="o">-</span><span class="nb">format</span>
</pre></div>
</div>
<p>Then modify the file to ensure that any indentation width parameters are at least four.
Once configured, you can run the tool as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clang</span><span class="o">-</span><span class="nb">format</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
<p>This will output what your file will look like if the changes are made, and to apply
them, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clang</span><span class="o">-</span><span class="nb">format</span> <span class="o">-</span><span class="n">i</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
<p>To run the tool on an entire directory, you can run the following analogous commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clang</span><span class="o">-</span><span class="nb">format</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">directory</span><span class="o">/*.</span><span class="n">c</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">directory</span><span class="o">/*.</span><span class="n">h</span>
<span class="n">clang</span><span class="o">-</span><span class="nb">format</span> <span class="o">-</span><span class="n">i</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">directory</span><span class="o">/*.</span><span class="n">c</span> <span class="n">modified</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">directory</span><span class="o">/*.</span><span class="n">h</span>
</pre></div>
</div>
<p>Do note that this tool is best-effort, meaning that it will try to correct as
many errors as possible, but it may not correct <em>all</em> of them. Thus, it is
recommended that you run <code class="docutils literal notranslate"><span class="pre">cpplint</span></code> to double check and make any other style
fixes manually.</p>
</section>
<section id="python-pep8-black">
<span id="contributing-code-formatting"></span><h3><a class="toc-backref" href="#id7">Python (PEP8 / black)</a><a class="headerlink" href="#python-pep8-black" title="Permalink to this headline">¶</a></h3>
<p>pandas follows the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard
and uses <a class="reference external" href="https://black.readthedocs.io/en/stable/">Black</a> and
<a class="reference external" href="https://flake8.pycqa.org/en/latest/">Flake8</a> to ensure a consistent code
format throughout the project. We encourage you to use <a class="reference internal" href="#contributing-pre-commit"><span class="std std-ref">pre-commit</span></a>.</p>
<p><a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> will run those tools and
report any stylistic errors in your code. Therefore, it is helpful before
submitting code to run the check yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">black</span> <span class="n">pandas</span>
<span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="o">-</span><span class="n">u</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">flake8</span> <span class="o">--</span><span class="n">diff</span>
</pre></div>
</div>
<p>to auto-format your code. Additionally, many editors have plugins that will
apply <code class="docutils literal notranslate"><span class="pre">black</span></code> as you edit files.</p>
<p>You should use a <code class="docutils literal notranslate"><span class="pre">black</span></code> version 21.5b2 as previous versions are not compatible
with the pandas codebase.</p>
<p>One caveat about <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">upstream/main</span> <span class="pre">-u</span> <span class="pre">--</span> <span class="pre">&quot;*.py&quot;</span> <span class="pre">|</span> <span class="pre">flake8</span> <span class="pre">--diff</span></code>: this
command will catch any stylistic errors in your changes specifically, but
be beware it may not catch all of them. For example, if you delete the only
usage of an imported function, it is stylistically incorrect to import an
unused function. However, style-checking the diff will not catch this because
the actual import is not part of the diff. Thus, for completeness, you should
run this command, though it may take longer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="n">flake8</span>
</pre></div>
</div>
<p>Note that on macOS, the <code class="docutils literal notranslate"><span class="pre">-r</span></code> flag is not available, so you have to omit it and
run this slightly modified command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">flake8</span>
</pre></div>
</div>
<p>Windows does not support the <code class="docutils literal notranslate"><span class="pre">xargs</span></code> command (unless installed for example
via the <a class="reference external" href="http://www.mingw.org/">MinGW</a> toolchain), but one can imitate the
behaviour as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">/</span><span class="n">f</span> <span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;git diff upstream/main --name-only -- &quot;*.py&quot;&#39;</span><span class="p">)</span> <span class="n">do</span> <span class="n">flake8</span> <span class="o">%</span><span class="n">i</span>
</pre></div>
</div>
<p>This will get all the files being changed by the PR (and ending with <code class="docutils literal notranslate"><span class="pre">.py</span></code>),
and run <code class="docutils literal notranslate"><span class="pre">flake8</span></code> on them, one after the other.</p>
<p>Note that these commands can be run analogously with <code class="docutils literal notranslate"><span class="pre">black</span></code>.</p>
</section>
<section id="import-formatting">
<span id="contributing-import-formatting"></span><h3><a class="toc-backref" href="#id8">Import formatting</a><a class="headerlink" href="#import-formatting" title="Permalink to this headline">¶</a></h3>
<p>pandas uses <a class="reference external" href="https://pypi.org/project/isort/">isort</a> to standardise import
formatting across the codebase.</p>
<p>A guide to import layout as per pep8 can be found <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#imports">here</a>.</p>
<p>A summary of our current import sections ( in order ):</p>
<ul class="simple">
<li><p>Future</p></li>
<li><p>Python Standard Library</p></li>
<li><p>Third Party</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas._libs</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas.compat</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas.util._*</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas.errors</span></code> (largely not dependent on <code class="docutils literal notranslate"><span class="pre">pandas.core</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas.core.dtypes</span></code> (largely not dependent on the rest of <code class="docutils literal notranslate"><span class="pre">pandas.core</span></code>)</p></li>
<li><p>Rest of <code class="docutils literal notranslate"><span class="pre">pandas.core.*</span></code></p></li>
<li><p>Non-core <code class="docutils literal notranslate"><span class="pre">pandas.io</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas.plotting</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas.tseries</span></code></p></li>
<li><p>Local application/library specific imports</p></li>
</ul>
<p>Imports are alphabetically sorted within these sections.</p>
<p>As part of <a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> checks we run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">isort</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">only</span> <span class="n">pandas</span>
</pre></div>
</div>
<p>to check that imports are correctly formatted as per the <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>.</p>
<p>If you see output like the below in <a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> checks:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Check import format using isort
ERROR: /home/travis/build/pandas-dev/pandas/pandas/io/pytables.py Imports are incorrectly sorted
Check import format using isort DONE
The <span class="nb">command</span> <span class="s2">&quot;ci/code_checks.sh&quot;</span> exited with <span class="m">1</span>
</pre></div>
</div>
<p>You should run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">isort</span> <span class="n">pandas</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">pytables</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>to automatically format imports correctly. This will modify your local copy of the files.</p>
<p>Alternatively, you can run a command similar to what was suggested for <code class="docutils literal notranslate"><span class="pre">black</span></code> and <code class="docutils literal notranslate"><span class="pre">flake8</span></code> <a class="reference internal" href="#contributing-code-formatting"><span class="std std-ref">right above</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="n">isort</span>
</pre></div>
</div>
<p>Where similar caveats apply if you are on macOS or Windows.</p>
<p>You can then verify the changes look ok, then git <a class="reference internal" href="contributing.html#contributing-commit-code"><span class="std std-ref">commit</span></a> and <a class="reference internal" href="contributing.html#contributing-push-code"><span class="std std-ref">push</span></a>.</p>
</section>
<section id="backwards-compatibility">
<h3><a class="toc-backref" href="#id9">Backwards compatibility</a><a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h3>
<p>Please try to maintain backward compatibility. pandas has lots of users with lots of
existing code, so don’t break it if at all possible.  If you think breakage is required,
clearly state why as part of the pull request.  Also, be careful when changing method
signatures and add deprecation warnings where needed. Also, add the deprecated sphinx
directive to the deprecated functions or methods.</p>
<p>If a function with the same arguments as the one being deprecated exist, you can use
the <code class="docutils literal notranslate"><span class="pre">pandas.util._decorators.deprecate</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.util._decorators</span> <span class="kn">import</span> <span class="n">deprecate</span>

<span class="n">deprecate</span><span class="p">(</span><span class="s1">&#39;old_func&#39;</span><span class="p">,</span> <span class="s1">&#39;new_func&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Otherwise, you need to do it manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">old_func</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Summary of the function.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">       Use new_func instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Use new_func instead.&#39;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">new_func</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">new_func</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>You’ll also need to</p>
<ol class="arabic simple">
<li><p>Write a new test that asserts a warning is issued when calling with the deprecated argument</p></li>
<li><p>Update all of pandas existing tests and code to use the new argument</p></li>
</ol>
<p>See <a class="reference internal" href="#contributing-warnings"><span class="std std-ref">Testing warnings</span></a> for more.</p>
</section>
</section>
<section id="type-hints">
<span id="contributing-type-hints"></span><h2><a class="toc-backref" href="#id10">Type hints</a><a class="headerlink" href="#type-hints" title="Permalink to this headline">¶</a></h2>
<p>pandas strongly encourages the use of <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> style type hints. New development should contain type hints and pull requests to annotate existing code are accepted as well!</p>
<section id="style-guidelines">
<h3><a class="toc-backref" href="#id11">Style guidelines</a><a class="headerlink" href="#style-guidelines" title="Permalink to this headline">¶</a></h3>
<p>Type imports should follow the <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">...</span></code> convention. Some types do not need to be imported since <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0585/"><strong>PEP 585</strong></a> some builtin constructs, such as <code class="docutils literal notranslate"><span class="pre">list</span></code> and <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, can directly be used for type annotations. So rather than</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typing</span>

<span class="n">primes</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>You should write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Optional</span></code> should be  avoided in favor of the shorter <code class="docutils literal notranslate"><span class="pre">|</span> <span class="pre">None</span></code>, so instead of</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="n">maybe_primes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="n">maybe_primes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>You should write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>  <span class="c1"># noqa: F404</span>

<span class="n">maybe_primes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>In some cases in the code base classes may define class variables that shadow builtins. This causes an issue as described in <a class="reference external" href="https://github.com/python/mypy/issues/1775#issuecomment-310969854">Mypy 1775</a>. The defensive solution here is to create an unambiguous alias of the builtin and use that without your annotation. For example, if you come across a definition like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass1</span><span class="p">:</span>
    <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The appropriate way to annotate this would be as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">str_type</span> <span class="o">=</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">SomeClass2</span><span class="p">:</span>
    <span class="nb">str</span><span class="p">:</span> <span class="n">str_type</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>In some cases you may be tempted to use <code class="docutils literal notranslate"><span class="pre">cast</span></code> from the typing module when you know better than the analyzer. This occurs particularly when using custom inference functions. For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">pandas.core.dtypes.common</span> <span class="kn">import</span> <span class="n">is_number</span>

<span class="k">def</span> <span class="nf">cannot_infer_bad</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>

    <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Reasonably only str objects would reach this but...</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># Mypy complains without this!</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
<p>The limitation here is that while a human can reasonably understand that <code class="docutils literal notranslate"><span class="pre">is_number</span></code> would catch the <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code> types mypy cannot make that same inference just yet (see <a class="reference external" href="https://github.com/python/mypy/issues/5206">mypy #5206</a>. While the above works, the use of <code class="docutils literal notranslate"><span class="pre">cast</span></code> is <strong>strongly discouraged</strong>. Where applicable a refactor of the code to appease static analysis is preferable</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cannot_infer_good</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>With custom types and inference this is not always possible so exceptions are made, but every effort should be exhausted to avoid <code class="docutils literal notranslate"><span class="pre">cast</span></code> before going down such paths.</p>
</section>
<section id="pandas-specific-types">
<h3><a class="toc-backref" href="#id12">pandas-specific types</a><a class="headerlink" href="#pandas-specific-types" title="Permalink to this headline">¶</a></h3>
<p>Commonly used types specific to pandas will appear in <a class="reference external" href="https://github.com/pandas-dev/pandas/blob/main/pandas/_typing.py">pandas._typing</a> and you should use these where applicable. This module is private for now but ultimately this should be exposed to third party libraries who want to implement type checking against pandas.</p>
<p>For example, quite a few functions in pandas accept a <code class="docutils literal notranslate"><span class="pre">dtype</span></code> argument. This can be expressed as a string like <code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code>, a <code class="docutils literal notranslate"><span class="pre">numpy.dtype</span></code> like <code class="docutils literal notranslate"><span class="pre">np.int64</span></code> or even a pandas <code class="docutils literal notranslate"><span class="pre">ExtensionDtype</span></code> like <code class="docutils literal notranslate"><span class="pre">pd.CategoricalDtype</span></code>. Rather than burden the user with having to constantly annotate all of those options, this can simply be imported and reused from the pandas._typing module</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas._typing</span> <span class="kn">import</span> <span class="n">Dtype</span>

<span class="k">def</span> <span class="nf">as_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n">Dtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This module will ultimately house types for repeatedly used concepts like “path-like”, “array-like”, “numeric”, etc… and can also hold aliases for commonly appearing parameters like <code class="docutils literal notranslate"><span class="pre">axis</span></code>. Development of this module is active so be sure to refer to the source for the most up to date list of available types.</p>
</section>
<section id="validating-type-hints">
<h3><a class="toc-backref" href="#id13">Validating type hints</a><a class="headerlink" href="#validating-type-hints" title="Permalink to this headline">¶</a></h3>
<p>pandas uses <a class="reference external" href="http://mypy-lang.org">mypy</a> and <a class="reference external" href="https://github.com/microsoft/pyright">pyright</a> to statically analyze the code base and type hints. After making any change you can ensure your type hints are correct by running</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mypy

<span class="c1"># let pre-commit setup and run pyright</span>
pre-commit run --hook-stage manual --all-files pyright
<span class="c1"># or if pyright is installed (requires node.js)</span>
pyright
</pre></div>
</div>
<p>A recent version of <code class="docutils literal notranslate"><span class="pre">numpy</span></code> (&gt;=1.21.0) is required for type validation.</p>
</section>
<section id="testing-type-hints-in-code-using-pandas">
<span id="contributing-ci"></span><h3><a class="toc-backref" href="#id14">Testing type hints in code using pandas</a><a class="headerlink" href="#testing-type-hints-in-code-using-pandas" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>Pandas is not yet a py.typed library (<span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a>)!
The primary purpose of locally declaring pandas as a py.typed library is to test and
improve the pandas-builtin type annotations.</p></li>
</ul>
</div>
<p>Until pandas becomes a py.typed library, it is possible to easily experiment with the type
annotations shipped with pandas by creating an empty file named “py.typed” in the pandas
installation folder:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python -c &quot;import pandas; import pathlib; (pathlib.Path(pandas.__path__[0]) / &#39;py.typed&#39;).touch()&quot;
</pre></div>
</div>
<p>The existence of the py.typed file signals to type checkers that pandas is already a py.typed
library. This makes type checkers aware of the type annotations shipped with pandas.</p>
</section>
</section>
<section id="testing-with-continuous-integration">
<h2><a class="toc-backref" href="#id15">Testing with continuous integration</a><a class="headerlink" href="#testing-with-continuous-integration" title="Permalink to this headline">¶</a></h2>
<p>The pandas test suite will run automatically on <a class="reference external" href="https://github.com/features/actions/">GitHub Actions</a>
continuous integration services, once your pull request is submitted.
However, if you wish to run the test suite on a branch prior to submitting the pull request,
then the continuous integration services need to be hooked to your GitHub repository. Instructions are here
for <a class="reference external" href="https://docs.github.com/en/actions/">GitHub Actions</a>.</p>
<p>A pull-request will be considered for merging when you have an all ‘green’ build. If any tests are failing,
then you will get a red ‘X’, where you can click through to see the individual failed tests.
This is an example of a green build.</p>
<img alt="../_images/ci.png" src="../_images/ci.png" />
</section>
<section id="test-driven-development-code-writing">
<span id="contributing-tdd"></span><h2><a class="toc-backref" href="#id16">Test-driven development/code writing</a><a class="headerlink" href="#test-driven-development-code-writing" title="Permalink to this headline">¶</a></h2>
<p>pandas is serious about testing and strongly encourages contributors to embrace
<a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development (TDD)</a>.
This development process “relies on the repetition of a very short development cycle:
first the developer writes an (initially failing) automated test case that defines a desired
improvement or new function, then produces the minimum amount of code to pass that test.”
So, before actually writing any code, you should write your tests.  Often the test can be
taken from the original GitHub issue.  However, it is always worth considering additional
use cases and writing corresponding tests.</p>
<p>Adding tests is one of the most common requests after code is pushed to pandas.  Therefore,
it is worth getting in the habit of writing tests ahead of time so this is never an issue.</p>
<p>Like many packages, pandas uses <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> and the convenient
extensions in <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.testing.html">numpy.testing</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The earliest supported pytest version is 5.0.1.</p>
</div>
<section id="writing-tests">
<h3><a class="toc-backref" href="#id17">Writing tests</a><a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>All tests should go into the <code class="docutils literal notranslate"><span class="pre">tests</span></code> subdirectory of the specific package.
This folder contains many current examples of tests, and we suggest looking to these for
inspiration.  If your test requires working with files or
network connectivity, there is more information on the <a class="reference external" href="https://github.com/pandas-dev/pandas/wiki/Testing">wiki Testing</a> of the wiki.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pandas._testing</span></code> module has many special <code class="docutils literal notranslate"><span class="pre">assert</span></code> functions that
make it easier to make statements about whether Series or DataFrame objects are
equivalent. The easiest way to verify that your code is correct is to
explicitly construct the result you expect, then compare the actual result to
the expected correct result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;index&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span>
        <span class="s1">&#39;columns&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;One&#39;</span><span class="p">,</span> <span class="s1">&#39;One&#39;</span><span class="p">,</span> <span class="s1">&#39;One&#39;</span><span class="p">,</span> <span class="s1">&#39;Two&#39;</span><span class="p">,</span> <span class="s1">&#39;Two&#39;</span><span class="p">,</span> <span class="s1">&#39;Two&#39;</span><span class="p">],</span>
        <span class="s1">&#39;values&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pivoted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">)</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;One&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span> <span class="p">:</span> <span class="mf">2.</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span> <span class="p">:</span> <span class="mf">3.</span><span class="p">},</span>
        <span class="s1">&#39;Two&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span> <span class="p">:</span> <span class="mf">2.</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span> <span class="p">:</span> <span class="mf">3.</span><span class="p">}</span>
    <span class="p">})</span>

    <span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">pivoted</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
</div>
<p>Please remember to add the Github Issue Number as a comment to a new test.
E.g. “# brief comment, see GH#28907”</p>
</section>
<section id="transitioning-to-pytest">
<h3><a class="toc-backref" href="#id18">Transitioning to <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a><a class="headerlink" href="#transitioning-to-pytest" title="Permalink to this headline">¶</a></h3>
<p>pandas existing test structure is <em>mostly</em> class-based, meaning that you will typically find tests wrapped in a class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestReallyCoolFeature</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Going forward, we are moving to a more <em>functional</em> style using the <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> framework, which offers a richer testing
framework that will facilitate testing and developing. Thus, instead of writing test classes, we will write test functions like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_really_cool_feature</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="using-pytest">
<h3><a class="toc-backref" href="#id19">Using <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a><a class="headerlink" href="#using-pytest" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of a self-contained set of tests that illustrate multiple features that we like to use.</p>
<ul class="simple">
<li><p>functional style: tests are like <code class="docutils literal notranslate"><span class="pre">test_*</span></code> and <em>only</em> take arguments that are either fixtures or parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pytest.mark</span></code> can be used to set metadata on test functions, e.g. <code class="docutils literal notranslate"><span class="pre">skip</span></code> or <code class="docutils literal notranslate"><span class="pre">xfail</span></code>.</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">parametrize</span></code>: allow testing of multiple cases</p></li>
<li><p>to set a mark on a parameter, <code class="docutils literal notranslate"><span class="pre">pytest.param(...,</span> <span class="pre">marks=...)</span></code> syntax should be used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixture</span></code>, code for object construction, on a per-test basis</p></li>
<li><p>using bare <code class="docutils literal notranslate"><span class="pre">assert</span></code> for scalars and truth-testing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm.assert_series_equal</span></code> (and its counter part <code class="docutils literal notranslate"><span class="pre">tm.assert_frame_equal</span></code>), for pandas object comparisons.</p></li>
<li><p>the typical pattern of constructing an <code class="docutils literal notranslate"><span class="pre">expected</span></code> and comparing versus the <code class="docutils literal notranslate"><span class="pre">result</span></code></p></li>
</ul>
<p>We would name this file <code class="docutils literal notranslate"><span class="pre">test_cool_feature.py</span></code> and put in an appropriate place in the <code class="docutils literal notranslate"><span class="pre">pandas/tests/</span></code> structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;int8&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_dtypes</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span> <span class="o">==</span> <span class="n">dtype</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;int16&#39;</span><span class="p">,</span> <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">),</span>
              <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span>
                  <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;to show how it works&#39;</span><span class="p">))])</span>
<span class="k">def</span> <span class="nf">test_mark</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;float32&#39;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">series</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int8&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>


<span class="k">def</span> <span class="nf">test_series</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">dtype</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">tm</span><span class="o">.</span><span class="n">assert_series_equal</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
</div>
<p>A test run of this yields</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">((</span>pandas<span class="o">)</span> bash-3.2$ pytest  test_cool_feature.py  -v
<span class="o">===========================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================</span>
platform darwin -- Python <span class="m">3</span>.6.2, pytest-3.6.0, py-1.4.31, pluggy-0.4.0
collected <span class="m">11</span> items

tester.py::test_dtypes<span class="o">[</span>int8<span class="o">]</span> PASSED
tester.py::test_dtypes<span class="o">[</span>int16<span class="o">]</span> PASSED
tester.py::test_dtypes<span class="o">[</span>int32<span class="o">]</span> PASSED
tester.py::test_dtypes<span class="o">[</span>int64<span class="o">]</span> PASSED
tester.py::test_mark<span class="o">[</span>float32<span class="o">]</span> PASSED
tester.py::test_mark<span class="o">[</span>int16<span class="o">]</span> SKIPPED
tester.py::test_mark<span class="o">[</span>int32<span class="o">]</span> xfail
tester.py::test_series<span class="o">[</span>int8<span class="o">]</span> PASSED
tester.py::test_series<span class="o">[</span>int16<span class="o">]</span> PASSED
tester.py::test_series<span class="o">[</span>int32<span class="o">]</span> PASSED
tester.py::test_series<span class="o">[</span>int64<span class="o">]</span> PASSED
</pre></div>
</div>
<p>Tests that we have <code class="docutils literal notranslate"><span class="pre">parametrized</span></code> are now accessible via the test name, for example we could run these with <code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">int8</span></code> to sub-select <em>only</em> those tests which match <code class="docutils literal notranslate"><span class="pre">int8</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">((</span>pandas<span class="o">)</span> bash-3.2$ pytest  test_cool_feature.py  -v -k <span class="nv">int8</span>
<span class="o">===========================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================</span>
platform darwin -- Python <span class="m">3</span>.6.2, pytest-3.6.0, py-1.4.31, pluggy-0.4.0
collected <span class="m">11</span> items

test_cool_feature.py::test_dtypes<span class="o">[</span>int8<span class="o">]</span> PASSED
test_cool_feature.py::test_series<span class="o">[</span>int8<span class="o">]</span> PASSED
</pre></div>
</div>
</section>
<section id="using-hypothesis">
<span id="id1"></span><h3><a class="toc-backref" href="#id20">Using <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code></a><a class="headerlink" href="#using-hypothesis" title="Permalink to this headline">¶</a></h3>
<p>Hypothesis is a library for property-based testing.  Instead of explicitly
parametrizing a test, you can describe <em>all</em> valid inputs and let Hypothesis
try to find a failing input.  Even better, no matter how many random examples
it tries, Hypothesis always reports a single minimal counterexample to your
assertions - often an example that you would never have thought to test.</p>
<p>See <a class="reference external" href="https://hypothesis.works/articles/getting-started-with-hypothesis/">Getting Started with Hypothesis</a>
for more of an introduction, then <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/index.html">refer to the Hypothesis documentation
for details</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="n">any_json_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">deferred</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span>
    <span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span> <span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
    <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">any_json_value</span><span class="p">),</span> <span class="n">st</span><span class="o">.</span><span class="n">dictionaries</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">any_json_value</span><span class="p">)</span>
<span class="p">))</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">any_json_value</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_json_roundtrip</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">value</span> <span class="o">==</span> <span class="n">result</span>
</pre></div>
</div>
<p>This test shows off several useful features of Hypothesis, as well as
demonstrating a good use-case: checking properties that should hold over
a large or complicated domain of inputs.</p>
<p>To keep the pandas test suite running quickly, parametrized tests are
preferred if the inputs or logic are simple, with Hypothesis tests reserved
for cases with complex logic or where there are too many combinations of
options or subtle interactions to test (or think of!) all of them.</p>
</section>
<section id="testing-warnings">
<span id="contributing-warnings"></span><h3><a class="toc-backref" href="#id21">Testing warnings</a><a class="headerlink" href="#testing-warnings" title="Permalink to this headline">¶</a></h3>
<p>By default, one of pandas CI workers will fail if any unhandled warnings are emitted.</p>
<p>If your change involves checking that a warning is actually emitted, use
<code class="docutils literal notranslate"><span class="pre">tm.assert_produces_warning(ExpectedWarning)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas._testing</span> <span class="k">as</span> <span class="nn">tm</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tm</span><span class="o">.</span><span class="n">assert_produces_warning</span><span class="p">(</span><span class="ne">FutureWarning</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">some_operation</span><span class="p">()</span>
</pre></div>
</div>
<p>We prefer this to the <code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> context manager because ours checks that the warning’s
stacklevel is set correctly. The stacklevel is what ensure the <em>user’s</em> file name and line number
is printed in the warning, rather than something internal to pandas. It represents the number of
function calls from user code (e.g. <code class="docutils literal notranslate"><span class="pre">df.some_operation()</span></code>) to the function that actually emits
the warning. Our linter will fail the build if you use <code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> in a test.</p>
<p>If you have a test that would emit a warning, but you aren’t actually testing the
warning itself (say because it’s going to be removed in the future, or because we’re
matching a 3rd-party library’s behavior), then use <code class="docutils literal notranslate"><span class="pre">pytest.mark.filterwarnings</span></code> to
ignore the error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore:msg:category&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_thing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If the test generates a warning of class <code class="docutils literal notranslate"><span class="pre">category</span></code> whose message starts
with <code class="docutils literal notranslate"><span class="pre">msg</span></code>, the warning will be ignored and the test will pass.</p>
<p>If you need finer-grained control, you can use Python’s usual
<a class="reference external" href="https://docs.python.org/3/library/warnings.html">warnings module</a>
to control whether a warning is ignored / raised at different places within
a single test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="c1"># Or use warnings.filterwarnings(...)</span>
</pre></div>
</div>
<p>Alternatively, consider breaking up the unit test.</p>
</section>
</section>
<section id="running-the-test-suite">
<h2><a class="toc-backref" href="#id22">Running the test suite</a><a class="headerlink" href="#running-the-test-suite" title="Permalink to this headline">¶</a></h2>
<p>The tests can then be run directly inside your Git clone (without having to
install pandas) by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">pandas</span>
</pre></div>
</div>
<p>The tests suite is exhaustive and takes around 20 minutes to run.  Often it is
worth running only a subset of tests first around your changes before running the
entire suite.</p>
<p>The easiest way to do this is with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">pandas</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">k</span> <span class="n">regex_matching_test_name</span>
</pre></div>
</div>
<p>Or with one of the following constructs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">pandas</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="p">[</span><span class="n">test</span><span class="o">-</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">py</span>
<span class="n">pytest</span> <span class="n">pandas</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="p">[</span><span class="n">test</span><span class="o">-</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">py</span><span class="p">::[</span><span class="n">TestClass</span><span class="p">]</span>
<span class="n">pytest</span> <span class="n">pandas</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="p">[</span><span class="n">test</span><span class="o">-</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">py</span><span class="p">::[</span><span class="n">TestClass</span><span class="p">]::[</span><span class="n">test_method</span><span class="p">]</span>
</pre></div>
</div>
<p>Using <a class="reference external" href="https://pypi.org/project/pytest-xdist">pytest-xdist</a>, one can
speed up local testing on multicore machines. To use this feature, you will
need to install <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code> via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span><span class="o">-</span><span class="n">xdist</span>
</pre></div>
</div>
<p>Two scripts are provided to assist with this.  These scripts distribute
testing across 4 threads.</p>
<p>On Unix variants, one can type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_fast</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>On Windows, one can type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_fast</span><span class="o">.</span><span class="n">bat</span>
</pre></div>
</div>
<p>This can significantly reduce the time it takes to locally run tests before
submitting a pull request.</p>
<p>For more, see the <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> documentation.</p>
<p>Furthermore one can run</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>with an imported pandas to run tests similarly.</p>
</section>
<section id="running-the-performance-test-suite">
<h2><a class="toc-backref" href="#id23">Running the performance test suite</a><a class="headerlink" href="#running-the-performance-test-suite" title="Permalink to this headline">¶</a></h2>
<p>Performance matters and it is worth considering whether your code has introduced
performance regressions. pandas is in the process of migrating to
<a class="reference external" href="https://github.com/airspeed-velocity/asv">asv benchmarks</a>
to enable easy monitoring of the performance of critical pandas operations.
These benchmarks are all found in the <code class="docutils literal notranslate"><span class="pre">pandas/asv_bench</span></code> directory, and the
test results can be found <a class="reference external" href="https://pandas.pydata.org/speed/pandas/">here</a>.</p>
<p>To use all features of asv, you will need either <code class="docutils literal notranslate"><span class="pre">conda</span></code> or
<code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>. For more details please check the <a class="reference external" href="https://asv.readthedocs.io/en/latest/installing.html">asv installation
webpage</a>.</p>
<p>To install asv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">airspeed</span><span class="o">-</span><span class="n">velocity</span><span class="o">/</span><span class="n">asv</span>
</pre></div>
</div>
<p>If you need to run a benchmark, change your directory to <code class="docutils literal notranslate"><span class="pre">asv_bench/</span></code> and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">continuous</span> <span class="o">-</span><span class="n">f</span> <span class="mf">1.1</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="n">HEAD</span>
</pre></div>
</div>
<p>You can replace <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> with the name of the branch you are working on,
and report benchmarks that changed by more than 10%.
The command uses <code class="docutils literal notranslate"><span class="pre">conda</span></code> by default for creating the benchmark
environments. If you want to use virtualenv instead, write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">continuous</span> <span class="o">-</span><span class="n">f</span> <span class="mf">1.1</span> <span class="o">-</span><span class="n">E</span> <span class="n">virtualenv</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="n">HEAD</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-E</span> <span class="pre">virtualenv</span></code> option should be added to all <code class="docutils literal notranslate"><span class="pre">asv</span></code> commands
that run benchmarks. The default value is defined in <code class="docutils literal notranslate"><span class="pre">asv.conf.json</span></code>.</p>
<p>Running the full benchmark suite can be an all-day process, depending on your
hardware and its resource utilization. However, usually it is sufficient to paste
only a subset of the results into the pull request to show that the committed changes
do not cause unexpected performance regressions.  You can run specific benchmarks
using the <code class="docutils literal notranslate"><span class="pre">-b</span></code> flag, which takes a regular expression. For example, this will
only run benchmarks from a <code class="docutils literal notranslate"><span class="pre">pandas/asv_bench/benchmarks/groupby.py</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">continuous</span> <span class="o">-</span><span class="n">f</span> <span class="mf">1.1</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="n">HEAD</span> <span class="o">-</span><span class="n">b</span> <span class="o">^</span><span class="n">groupby</span>
</pre></div>
</div>
<p>If you want to only run a specific group of benchmarks from a file, you can do it
using <code class="docutils literal notranslate"><span class="pre">.</span></code> as a separator. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">continuous</span> <span class="o">-</span><span class="n">f</span> <span class="mf">1.1</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span> <span class="n">HEAD</span> <span class="o">-</span><span class="n">b</span> <span class="n">groupby</span><span class="o">.</span><span class="n">GroupByMethods</span>
</pre></div>
</div>
<p>will only run the <code class="docutils literal notranslate"><span class="pre">GroupByMethods</span></code> benchmark defined in <code class="docutils literal notranslate"><span class="pre">groupby.py</span></code>.</p>
<p>You can also run the benchmark suite using the version of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>
already installed in your current Python environment. This can be
useful if you do not have virtualenv or conda, or are using the
<code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">develop</span></code> approach discussed above; for the in-place build
you need to set <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, e.g.
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH=&quot;$PWD/..&quot;</span> <span class="pre">asv</span> <span class="pre">[remaining</span> <span class="pre">arguments]</span></code>.
You can run benchmarks using an existing Python
environment by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="o">-</span><span class="n">E</span> <span class="n">existing</span>
</pre></div>
</div>
<p>or, to use a specific Python interpreter,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asv</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="o">-</span><span class="n">E</span> <span class="n">existing</span><span class="p">:</span><span class="n">python3</span><span class="mf">.6</span>
</pre></div>
</div>
<p>This will display stderr from the benchmarks, and use your local
<code class="docutils literal notranslate"><span class="pre">python</span></code> that comes from your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.</p>
<p>Information on how to write a benchmark and how to use asv can be found in the
<a class="reference external" href="https://asv.readthedocs.io/en/latest/writing_benchmarks.html">asv documentation</a>.</p>
</section>
<section id="documenting-your-code">
<h2><a class="toc-backref" href="#id24">Documenting your code</a><a class="headerlink" href="#documenting-your-code" title="Permalink to this headline">¶</a></h2>
<p>Changes should be reflected in the release notes located in <code class="docutils literal notranslate"><span class="pre">doc/source/whatsnew/vx.y.z.rst</span></code>.
This file contains an ongoing change log for each release.  Add an entry to this file to
document your fix, enhancement or (unavoidable) breaking change.  Make sure to include the
GitHub issue number when adding your entry (using <code class="docutils literal notranslate"><span class="pre">:issue:`1234`</span></code> where <code class="docutils literal notranslate"><span class="pre">1234</span></code> is the
issue/pull request number). Your entry should be written using full sentences and proper
grammar.</p>
<p>When mentioning parts of the API, use a Sphinx <code class="docutils literal notranslate"><span class="pre">:func:</span></code>, <code class="docutils literal notranslate"><span class="pre">:meth:</span></code>, or <code class="docutils literal notranslate"><span class="pre">:class:</span></code>
directive as appropriate. Not all public API functions and methods have a
documentation page; ideally links would only be added if they resolve. You can
usually find similar examples by checking the release notes for one of the previous
versions.</p>
<p>If your code is a bugfix, add your entry to the relevant bugfix section. Avoid
adding to the <code class="docutils literal notranslate"><span class="pre">Other</span></code> section; only in rare cases should entries go there.
Being as concise as possible, the description of the bug should include how the
user may encounter it and an indication of the bug itself, e.g.
“produces incorrect results” or “incorrectly raises”. It may be necessary to also
indicate the new behavior.</p>
<p>If your code is an enhancement, it is most likely necessary to add usage
examples to the existing documentation.  This can be done following the section
regarding <a class="reference internal" href="contributing_documentation.html#contributing-documentation"><span class="std std-ref">documentation</span></a>.
Further, to let users know when this feature was added, the <code class="docutils literal notranslate"><span class="pre">versionadded</span></code>
directive is used. The sphinx syntax for that is:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">versionadded</span><span class="p">::</span> 1.1.0
</pre></div>
</div>
<p>This will put the text <em>New in version 1.1.0</em> wherever you put the sphinx
directive. This should also be put in the docstring when adding a new function
or method (<a class="reference external" href="https://github.com/pandas-dev/pandas/blob/v0.20.2/pandas/core/frame.py#L1495">example</a>)
or a new keyword argument (<a class="reference external" href="https://github.com/pandas-dev/pandas/blob/v0.20.2/pandas/core/generic.py#L568">example</a>).</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="contributing_docstring.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">pandas docstring guide</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="code_style.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">pandas code style guide</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2008-2022, the pandas development team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>